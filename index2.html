<!DOCTYPE html>
<html>
<head>
<title>Voice Booking Platform</title>

<style>
body{
 font-family: Arial;
 background:#0d1117;
 color:white;
 text-align:center;
}
.container{
 width:95%;
 margin:auto;
 margin-top:20px;
 background:#161b22;
 padding:20px;
 border-radius:15px;
}
button{
 padding:15px 25px;
 border:none;
 border-radius:8px;
 cursor:pointer;
 margin:10px;
 font-size:16px;
}
#startBtn{background:#1f6feb;color:white;}
#stopBtn{background:#d0342c;color:white;}
#excelBtn{background:#2ea043;color:white;}
table{
 width:100%;
 border-collapse:collapse;
 margin-top:20px;
}
th,td{
 padding:10px;
 border:1px solid #30363d;
}
th{
 background:#21262d;
}
.recording{
 color:#58a6ff;
 font-size:18px;
 font-weight:bold;
}
</style>

</head>

<body>

<div class="container">
<h1>Ultra Accurate Voice Booking Entry Platform</h1>
<p>Speak booking details. System will convert to text and prepare Excel.</p>

<button id="startBtn">Start Voice</button>
<button id="stopBtn">Stop</button>
<button id="excelBtn">Download Excel</button>
<p id="status" class="recording"></p>

<h3>Recognized Text:</h3>
<p id="output"></p>

<table id="bookingTable">
<thead>
<tr>
<th>S.NO</th>
<th>Date</th>
<th>Booking ID</th>
<th>Guest Name</th>
<th>Booking Through</th>
<th>Check-in</th>
<th>Check-out</th>
<th>Rooms</th>
<th>Amount</th>
<th>Payment Mode</th>
</tr>
</thead>
<tbody></tbody>
</table>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
let recognition;
let finalTranscript = "";
let serial = 1;

let currentBooking = {
    bookingId: "",
    guest: "",
    through: "",
    checkin: "",
    checkout: "",
    rooms: "",
    amount: "",
    payment: ""
};

if ('webkitSpeechRecognition' in window) {
    recognition = new webkitSpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = false;
    recognition.lang = "en-US";

    recognition.onresult = function(event) {
        let transcript = event.results[event.resultIndex][0].transcript;
        finalTranscript += transcript + ". ";
        document.getElementById("output").innerText = finalTranscript;

        processSpeech(transcript);
    };

    recognition.onerror = function(event) {
        alert("Speech Recognition Error: " + event.error);
    };
}

document.getElementById("startBtn").onclick = function(){
    recognition.start();
    document.getElementById("status").innerText = "Listening... Speak now";
};

document.getElementById("stopBtn").onclick = function(){
    recognition.stop();
    document.getElementById("status").innerText = "Stopped";
};

function processSpeech(text){
    text = text.toLowerCase();

    // Capture fields
    let bookingId = (text.match(/booking id\s?([a-z0-9]+)/) || ["",""])[1].toUpperCase();
    let guest = (text.match(/guest name ([a-z ]+)/) || ["",""])[1].trim();
    let through = (text.match(/booking through ([a-z]+)/) || ["",""])[1].toUpperCase();
    let rooms = (text.match(/rooms (\d+)/) || ["",""])[1];
    let amount = (text.match(/amount (\d+)/) || ["",""])[1];
    let payment = (text.match(/payment mode ([a-z]+)/) || ["",""])[1].toUpperCase();

    let checkinMatch = text.match(/check in ([0-9a-z ]+)/);
    let checkoutMatch = text.match(/check out ([0-9a-z ]+)/);

    let checkin = checkinMatch ? checkinMatch[1].trim() : "";
    let checkout = checkoutMatch ? checkoutMatch[1].trim() : "";

    // Update buffer
    if(bookingId) currentBooking.bookingId = bookingId;
    if(guest) currentBooking.guest = guest;
    if(through) currentBooking.through = through;
    if(checkin) currentBooking.checkin = checkin;
    if(checkout) currentBooking.checkout = checkout;
    if(rooms) currentBooking.rooms = rooms;
    if(amount) currentBooking.amount = amount;
    if(payment) currentBooking.payment = payment;

    // When all filled, insert row
    if(
        currentBooking.bookingId &&
        currentBooking.guest &&
        currentBooking.through &&
        currentBooking.checkin &&
        currentBooking.checkout &&
        currentBooking.rooms &&
        currentBooking.amount &&
        currentBooking.payment
    ){
        addRow();
        resetBooking();
    }
}

function addRow(){
    const today = new Date().toLocaleDateString("en-IN");
    let table = document.querySelector("#bookingTable tbody");
    let row = document.createElement("tr");

    row.innerHTML = `
        <td>${serial++}</td>
        <td>${today}</td>
        <td>${currentBooking.bookingId}</td>
        <td>${currentBooking.guest}</td>
        <td>${currentBooking.through}</td>
        <td>${currentBooking.checkin}</td>
        <td>${currentBooking.checkout}</td>
        <td>${currentBooking.rooms}</td>
        <td>${currentBooking.amount}</td>
        <td>${currentBooking.payment}</td>
    `;
    table.appendChild(row);
}

function resetBooking(){
    currentBooking = {
        bookingId: "",
        guest: "",
        through: "",
        checkin: "",
        checkout: "",
        rooms: "",
        amount: "",
        payment: ""
    };
}

document.getElementById("excelBtn").onclick = function(){
    let table = document.getElementById("bookingTable");
    let wb = XLSX.utils.table_to_book(table, {sheet:"Bookings"});
    XLSX.writeFile(wb, "Daily_Booking_Report.xlsx");
};
</script>

</body>
</html>
